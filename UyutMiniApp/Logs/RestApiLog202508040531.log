2025-08-04 05:31:40.906 +09:00 [Error] [Microsoft.EntityFrameworkCore.Database.Command] [{ Id: 20102, Name: "Microsoft.EntityFrameworkCore.Database.Command.CommandError" }] Failed executing DbCommand ("3"ms) [Parameters=["@__UserId_0='?' (DbType = Guid)"], CommandType='Text', CommandTimeout='30']"
""SELECT o.\"Id\", o.\"CourierId\", o.\"CreatedAt\", o.\"OrderNumber\", o.\"OrderProcess\", o.\"OrderUrl\", o.\"PaymentMethod\", o.\"Status\", o.\"TotalAmount\", o.\"Type\", o.\"UpdatedAt\", o.\"UserId\", u.\"Id\", s.\"Id\", s.\"CustomMealId\", s.\"MenuItemId\", s.\"OrderId\", s.\"Price\", s.\"Quantity\", s.\"Id0\", s.\"CategoryId\", s.\"CreatedAt\", s.\"Description\", s.\"ImageUrl\", s.\"IsSet\", s.\"Name\", s.\"Price0\", s.\"UpdatedAt\", u.\"CreatedAt\", u.\"Name\", u.\"PhoneNumber\", u.\"Role\", u.\"SavedAddressId\", u.\"TelegramUserId\", u.\"UpdatedAt\"
FROM \"Orders\" AS o
INNER JOIN \"Users\" AS u ON o.\"UserId\" = u.\"Id\"
LEFT JOIN (
    SELECT o0.\"Id\", o0.\"CustomMealId\", o0.\"MenuItemId\", o0.\"OrderId\", o0.\"Price\", o0.\"Quantity\", m.\"Id\" AS \"Id0\", m.\"CategoryId\", m.\"CreatedAt\", m.\"Description\", m.\"ImageUrl\", m.\"IsSet\", m.\"Name\", m.\"Price\" AS \"Price0\", m.\"UpdatedAt\"
    FROM \"OrderItems\" AS o0
    LEFT JOIN \"MenuItems\" AS m ON o0.\"MenuItemId\" = m.\"Id\"
) AS s ON o.\"Id\" = s.\"OrderId\"
WHERE date_trunc('day', o.\"CreatedAt\", 'UTC') = date_trunc('day', now(), 'UTC') AND u.\"Id\" = @__UserId_0
ORDER BY o.\"Id\", u.\"Id\", s.\"Id\""
2025-08-04 05:31:40.942 +09:00 [Error] [Microsoft.EntityFrameworkCore.Query] [{ Id: 10100, Name: "Microsoft.EntityFrameworkCore.Query.QueryIterationFailed" }] An exception occurred while iterating over the results of a query for context type '"UyutMiniApp.Data.Contexts.UyutMiniAppDbContext"'."
""Npgsql.NpgsqlOperationInProgressException (0x80004005): A command is already in progress: SELECT o.\"Id\", o.\"CourierId\", o.\"CreatedAt\", o.\"OrderNumber\", o.\"OrderProcess\", o.\"OrderUrl\", o.\"PaymentMethod\", o.\"Status\", o.\"TotalAmount\", o.\"Type\", o.\"UpdatedAt\", o.\"UserId\", u.\"Id\", s.\"Id\", s.\"CustomMealId\", s.\"MenuItemId\", s.\"OrderId\", s.\"Price\", s.\"Quantity\", s.\"Id0\", s.\"CategoryId\", s.\"CreatedAt\", s.\"Description\", s.\"ImageUrl\", s.\"IsSet\", s.\"Name\", s.\"Price0\", s.\"UpdatedAt\", u.\"CreatedAt\", u.\"Name\", u.\"PhoneNumber\", u.\"Role\", u.\"SavedAddressId\", u.\"TelegramUserId\", u.\"UpdatedAt\"
FROM \"Orders\" AS o
INNER JOIN \"Users\" AS u ON o.\"UserId\" = u.\"Id\"
LEFT JOIN (
    SELECT o0.\"Id\", o0.\"CustomMealId\", o0.\"MenuItemId\", o0.\"OrderId\", o0.\"Price\", o0.\"Quantity\", m.\"Id\" AS \"Id0\", m.\"CategoryId\", m.\"CreatedAt\", m.\"Description\", m.\"ImageUrl\", m.\"IsSet\", m.\"Name\", m.\"Price\" AS \"Price0\", m.\"UpdatedAt\"
    FROM \"OrderItems\" AS o0
    LEFT JOIN \"MenuItems\" AS m ON o0.\"MenuItemId\" = m.\"Id\"
) AS s ON o.\"Id\" = s.\"OrderId\"
WHERE date_trunc('day', o.\"CreatedAt\", 'UTC') = date_trunc('day', now(), 'UTC')
ORDER BY o.\"Id\", u.\"Id\", s.\"Id\"
   at Npgsql.ThrowHelper.ThrowNpgsqlOperationInProgressException(NpgsqlCommand command)
   at Npgsql.Internal.NpgsqlConnector.<StartUserAction>g__DoStartUserAction|282_0(ConnectorState newState, NpgsqlCommand command, CancellationToken cancellationToken, Boolean attemptPgCancellation)
   at Npgsql.Internal.NpgsqlConnector.StartUserAction(ConnectorState newState, NpgsqlCommand command, CancellationToken cancellationToken, Boolean attemptPgCancellation)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()"
Npgsql.NpgsqlOperationInProgressException (0x80004005): A command is already in progress: SELECT o."Id", o."CourierId", o."CreatedAt", o."OrderNumber", o."OrderProcess", o."OrderUrl", o."PaymentMethod", o."Status", o."TotalAmount", o."Type", o."UpdatedAt", o."UserId", u."Id", s."Id", s."CustomMealId", s."MenuItemId", s."OrderId", s."Price", s."Quantity", s."Id0", s."CategoryId", s."CreatedAt", s."Description", s."ImageUrl", s."IsSet", s."Name", s."Price0", s."UpdatedAt", u."CreatedAt", u."Name", u."PhoneNumber", u."Role", u."SavedAddressId", u."TelegramUserId", u."UpdatedAt"
FROM "Orders" AS o
INNER JOIN "Users" AS u ON o."UserId" = u."Id"
LEFT JOIN (
    SELECT o0."Id", o0."CustomMealId", o0."MenuItemId", o0."OrderId", o0."Price", o0."Quantity", m."Id" AS "Id0", m."CategoryId", m."CreatedAt", m."Description", m."ImageUrl", m."IsSet", m."Name", m."Price" AS "Price0", m."UpdatedAt"
    FROM "OrderItems" AS o0
    LEFT JOIN "MenuItems" AS m ON o0."MenuItemId" = m."Id"
) AS s ON o."Id" = s."OrderId"
WHERE date_trunc('day', o."CreatedAt", 'UTC') = date_trunc('day', now(), 'UTC')
ORDER BY o."Id", u."Id", s."Id"
   at Npgsql.ThrowHelper.ThrowNpgsqlOperationInProgressException(NpgsqlCommand command)
   at Npgsql.Internal.NpgsqlConnector.<StartUserAction>g__DoStartUserAction|282_0(ConnectorState newState, NpgsqlCommand command, CancellationToken cancellationToken, Boolean attemptPgCancellation)
   at Npgsql.Internal.NpgsqlConnector.StartUserAction(ConnectorState newState, NpgsqlCommand command, CancellationToken cancellationToken, Boolean attemptPgCancellation)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
